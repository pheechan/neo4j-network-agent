# Docker Compose for neo4j-network-agent development
# Uses Neo4j Aura (cloud) - configure in .env file

services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    ports:
      - "8000:8000"
    environment:
      - LOCAL_LLM=${LOCAL_LLM:-ollama}
      - LOCAL_LLM_MODEL=${LOCAL_LLM_MODEL:-scb10x/typhoon2.1-gemma3-4b}
      - OLLAMA_URL=http://ollama:11434
      - LLM_PROVIDER=${LLM_PROVIDER:-ollama}
      # Use Neo4j Aura connection from .env
      - NEO4J_URI=${NEO4J_URI}
      - NEO4J_USERNAME=${NEO4J_USERNAME:-neo4j}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
      - NEO4J_DATABASE=${NEO4J_DATABASE:-neo4j}
    depends_on:
      - ollama

  frontend:
    # Next.js chat frontend
    build:
      context: ./next_frontend
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    depends_on:
      - backend
    environment:
      - BACKEND_URL=http://backend:8000

  # NOTE: Local Neo4j is disabled - using Neo4j Aura instead
  # Uncomment below if you want to use local Neo4j Docker instead of Aura
  # neo4j:
  #   image: neo4j:5.6
  #   ports:
  #     - "7474:7474"
  #     - "7687:7687"
  #   environment:
  #     - NEO4J_AUTH=${NEO4J_AUTH:-neo4j/neo4j}
  #   volumes:
  #     - neo4j_data:/data

  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama

volumes:
  ollama_data:
